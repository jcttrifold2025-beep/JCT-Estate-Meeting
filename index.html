<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JCT Estate Task Manager</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;color:#333}
.container{max-width:1400px;margin:0 auto;background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden}
.header{background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%);color:white;padding:30px;text-align:center}
.header h1{font-size:32px;margin-bottom:10px}
.header p{font-size:18px;opacity:0.9}
.tabs{display:flex;background:#f8f9fa;border-bottom:3px solid #dee2e6}
.tab{flex:1;padding:20px;text-align:center;font-size:20px;font-weight:bold;cursor:pointer;border:none;background:#f8f9fa;color:#6c757d;transition:all 0.3s;min-height:70px;display:flex;align-items:center;justify-content:center;gap:10px}
.tab:hover{background:#e9ecef}
.tab.active{background:white;color:#1e3c72;border-bottom:3px solid #1e3c72}
.tab i{font-size:24px}
.tab-content{display:none;padding:30px;animation:fadeIn 0.3s}
.tab-content.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
.stat-card{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);text-align:center}
.stat-card.completed{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%)}
.stat-card.progress{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%)}
.stat-card.overdue{background:linear-gradient(135deg,#fa709a 0%,#fee140 100%)}
.stat-card i{font-size:48px;margin-bottom:15px}
.stat-number{font-size:48px;font-weight:bold;margin:10px 0}
.stat-label{font-size:20px;opacity:0.9}
.progress-section{background:#f8f9fa;padding:30px;border-radius:15px;margin-bottom:30px}
.progress-label{font-size:20px;font-weight:bold;margin-bottom:15px;color:#1e3c72}
.progress-bar-container{background:#dee2e6;height:40px;border-radius:20px;overflow:hidden;position:relative}
.progress-bar{height:100%;background:linear-gradient(90deg,#11998e 0%,#38ef7d 100%);transition:width 0.5s ease;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:18px}
.filters{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:30px}
.filter-btn{padding:15px 30px;border:none;border-radius:10px;background:#e9ecef;color:#495057;font-size:18px;font-weight:bold;cursor:pointer;transition:all 0.3s;min-height:55px}
.filter-btn:hover{background:#dee2e6;transform:translateY(-2px)}
.filter-btn.active{background:#1e3c72;color:white}
.urgent-section{background:#fff3cd;border-left:5px solid #ffc107;padding:25px;border-radius:10px;margin-bottom:30px}
.urgent-section h3{color:#856404;margin-bottom:20px;font-size:24px}
.urgent-task{background:white;padding:20px;border-radius:10px;margin-bottom:15px;border-left:5px solid #dc3545}
.table-container{overflow-x:auto;background:#f8f9fa;border-radius:15px;padding:20px}
table{width:100%;border-collapse:collapse;background:white;border-radius:10px;overflow:hidden}
th{background:#1e3c72;color:white;padding:20px;text-align:left;font-size:18px;font-weight:bold}
td{padding:20px;border-bottom:1px solid #dee2e6;font-size:16px}
tr:hover{background:#f8f9fa}
.status-badge{padding:10px 20px;border-radius:20px;font-weight:bold;display:inline-block;font-size:14px;cursor:pointer;transition:all 0.3s;min-width:120px;text-align:center}
.status-badge:hover{transform:scale(1.05)}
.status-completed{background:#d4edda;color:#155724}
.status-progress{background:#fff3cd;color:#856404}
.status-notstarted{background:#f8d7da;color:#721c24}
.priority-badge{padding:8px 15px;border-radius:15px;font-weight:bold;display:inline-block;font-size:14px}
.priority-high{background:#dc3545;color:white}
.priority-medium{background:#ffc107;color:#333}
.priority-low{background:#28a745;color:white}
.btn{padding:15px 30px;border:none;border-radius:10px;font-size:18px;font-weight:bold;cursor:pointer;transition:all 0.3s;min-height:55px;display:inline-flex;align-items:center;justify-content:center;gap:10px}
.btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2)}
.btn-primary{background:#1e3c72;color:white}
.btn-success{background:#28a745;color:white}
.btn-danger{background:#dc3545;color:white}
.btn-secondary{background:#6c757d;color:white}
.action-btns{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:30px}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}
.modal.active{display:flex;align-items:center;justify-content:center}
.modal-content{background:white;padding:40px;border-radius:20px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}
.modal h2{margin-bottom:25px;color:#1e3c72;font-size:28px}
.form-group{margin-bottom:25px}
.form-group label{display:block;margin-bottom:10px;font-weight:bold;font-size:18px;color:#495057}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:15px;border:2px solid #dee2e6;border-radius:10px;font-size:16px}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#1e3c72}
.form-group textarea{min-height:100px;resize:vertical}
.days-badge{padding:5px 10px;border-radius:10px;font-weight:bold;font-size:14px;display:inline-block}
.days-overdue{background:#dc3545;color:white}
.days-soon{background:#ffc107;color:#333}
.days-ok{background:#28a745;color:white}
.success-message{background:#d4edda;color:#155724;padding:15px 20px;border-radius:10px;margin:20px 30px;display:none;border-left:5px solid #28a745}
.success-message.show{display:block}
@media(max-width:768px){
.header h1{font-size:24px}
.tabs{flex-direction:column}
.stats-grid{grid-template-columns:1fr}
th,td{padding:10px}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1><i class="fas fa-tasks"></i> JCT Estate Task Manager</h1>
<p>Simple. Powerful. Always Working.</p>
<div style="margin-top:15px">
<span id="loginStatus" style="font-size:16px"><i class="fas fa-eye"></i> View Mode</span>
<button class="btn btn-secondary" onclick="showLoginModal()" style="margin-left:15px;padding:10px 20px;min-height:auto"><i class="fas fa-key"></i> Admin Login</button>
<button class="btn btn-danger" onclick="logout()" id="logoutBtn" style="margin-left:10px;padding:10px 20px;min-height:auto;display:none"><i class="fas fa-sign-out-alt"></i> Logout</button>
</div>
</div>
<div class="success-message" id="successMessage">
<i class="fas fa-check-circle"></i> <span id="successText">Saved!</span>
</div>
<div class="tabs">
<button class="tab active" onclick="switchTab('dashboard')"><i class="fas fa-chart-line"></i> Dashboard</button>
<button class="tab" onclick="switchTab('tasks')"><i class="fas fa-list-check"></i> Tasks</button>
</div>
<div class="tab-content active" id="dashboard">
<div class="stats-grid">
<div class="stat-card"><i class="fas fa-clipboard-list"></i><div class="stat-number" id="totalTasks">0</div><div class="stat-label">Total Tasks</div></div>
<div class="stat-card completed"><i class="fas fa-check-circle"></i><div class="stat-number" id="completedTasks">0</div><div class="stat-label">Completed</div></div>
<div class="stat-card progress"><i class="fas fa-spinner"></i><div class="stat-number" id="progressTasks">0</div><div class="stat-label">In Progress</div></div>
<div class="stat-card overdue"><i class="fas fa-exclamation-triangle"></i><div class="stat-number" id="overdueTasks">0</div><div class="stat-label">Overdue</div></div>
</div>
<div class="progress-section">
<div class="progress-label">Overall Completion Progress</div>
<div class="progress-bar-container"><div class="progress-bar" id="progressBar">0%</div></div>
</div>
<div class="filters">
<button class="filter-btn active" onclick="filterByCategory('all')"><i class="fas fa-th"></i> All</button>
<button class="filter-btn" onclick="filterByCategory('Arts & Science')"><i class="fas fa-university"></i> Arts & Science</button>
<button class="filter-btn" onclick="filterByCategory('Polytechnic')"><i class="fas fa-cog"></i> Polytechnic</button>
<button class="filter-btn" onclick="filterByCategory('Engineering')"><i class="fas fa-wrench"></i> Engineering</button>
<button class="filter-btn" onclick="filterByCategory('Campus')"><i class="fas fa-building"></i> Campus</button>
<button class="filter-btn" onclick="filterByCategory('Girls Hostel')"><i class="fas fa-female"></i> Girls Hostel</button>
<button class="filter-btn" onclick="filterByCategory('Boys Hostel')"><i class="fas fa-male"></i> Boys Hostel</button>
<button class="filter-btn" onclick="filterByCategory('Mess')"><i class="fas fa-utensils"></i> Mess</button>
<button class="filter-btn" onclick="filterByCategory('Transport')"><i class="fas fa-bus"></i> Transport</button>
</div>
<div class="urgent-section">
<h3><i class="fas fa-bell"></i> Urgent Tasks</h3>
<div id="urgentTasksList"></div>
</div>
</div>
<div class="tab-content" id="tasks">
<div class="action-btns">
<button class="btn btn-primary" onclick="openAddTaskModal()"><i class="fas fa-plus"></i> Add Task</button>
<button class="btn btn-success" onclick="exportToCSV()"><i class="fas fa-download"></i> Export</button>
<button class="btn btn-secondary" onclick="document.getElementById('importFile').click()"><i class="fas fa-upload"></i> Import CSV</button>
<input type="file" id="importFile" accept=".csv" style="display:none" onchange="importFromCSV(event)">
<button class="btn" style="background:#0f9d58;color:white" onclick="openGoogleSheetsSetup()"><i class="fab fa-google"></i> Google Sheets</button>
<button class="btn" style="background:#4285f4;color:white" onclick="syncFromGoogleSheets()" id="syncBtn" disabled><i class="fas fa-sync"></i> Sync Now</button>
</div>
<div id="sheetsStatus" style="margin:20px 0;padding:15px;border-radius:10px;display:none"></div>
<div class="table-container">
<table><thead><tr><th>ID</th><th>Description</th><th>Category</th><th>Responsible</th><th>Deadline</th><th>Days</th><th>Status</th><th>Priority</th><th>Last Updated</th><th>Actions</th></tr></thead>
<tbody id="taskTableBody"></tbody></table>
</div>
</div>
</div>
<div class="modal" id="addTaskModal">
<div class="modal-content">
<h2><i class="fas fa-plus-circle"></i> <span id="modalTitle">Add Task</span></h2>
<input type="hidden" id="editTaskId">
<div class="form-group"><label>Description *</label><textarea id="taskDesc" required></textarea></div>
<div class="form-group"><label>Category *</label><select id="taskCategory" required><option value="">Select</option><option>Arts & Science</option><option>Polytechnic</option><option>Engineering</option><option>Campus</option><option>Girls Hostel</option><option>Boys Hostel</option><option>Mess</option><option>Transport</option></select></div>
<div class="form-group"><label>Responsible *</label><input type="text" id="taskResponsible" required></div>
<div class="form-group"><label>Deadline</label><input type="date" id="taskDeadline"></div>
<div class="form-group"><label>Status *</label><select id="taskStatus" required><option>Not Started</option><option>In Progress</option><option>Completed</option></select></div>
<div class="form-group"><label>Priority *</label><select id="taskPriority" required><option>Low</option><option>Medium</option><option>High</option></select></div>
<div class="form-group"><label>Remarks</label><textarea id="taskRemarks"></textarea></div>
<div class="action-btns">
<button class="btn btn-primary" onclick="saveTask()"><i class="fas fa-save"></i> Save</button>
<button class="btn btn-secondary" onclick="closeAddTaskModal()"><i class="fas fa-times"></i> Cancel</button>
</div>
</div>
</div>
<div class="modal" id="loginModal">
<div class="modal-content">
<h2><i class="fas fa-lock"></i> Admin Login</h2>
<div class="form-group"><label>Password</label><input type="password" id="adminPassword" placeholder="Enter admin password"></div>
<div class="action-btns">
<button class="btn btn-primary" onclick="login()"><i class="fas fa-sign-in-alt"></i> Login</button>
<button class="btn btn-secondary" onclick="closeLoginModal()"><i class="fas fa-times"></i> Cancel</button>
</div>
</div>
</div>
<div class="modal" id="googleSheetsModal">
<div class="modal-content">
<h2><i class="fab fa-google"></i> Connect Google Sheets</h2>
<div style="background:#fff3cd;padding:15px;border-radius:10px;margin-bottom:20px;border-left:5px solid #ffc107">
<h3 style="margin-bottom:10px;color:#856404"><i class="fas fa-info-circle"></i> Setup Instructions:</h3>
<ol style="margin-left:20px;color:#856404">
<li>Go to <a href="https://console.cloud.google.com/" target="_blank" style="color:#1e3c72">Google Cloud Console</a></li>
<li>Create a new project (or select existing)</li>
<li>Enable "Google Sheets API"</li>
<li>Go to "Credentials" → "Create Credentials" → "API Key"</li>
<li>Copy your API Key and paste below</li>
<li>Share your Google Sheet with: <strong>jcttrifold2025@gmail.com</strong></li>
<li>Copy your Sheet ID from URL: docs.google.com/spreadsheets/d/<strong>[SHEET_ID]</strong>/edit</li>
</ol>
</div>
<div class="form-group">
<label>Google API Key *</label>
<input type="text" id="googleApiKey" placeholder="AIzaSy...">
<small style="color:#6c757d">Your API key is stored locally and never shared</small>
</div>
<div class="form-group">
<label>Google Sheet ID *</label>
<input type="text" id="googleSheetId" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
<small style="color:#6c757d">Found in your sheet URL</small>
</div>
<div class="form-group">
<label>Sheet Name (Tab)</label>
<input type="text" id="googleSheetName" placeholder="Sheet1" value="Sheet1">
<small style="color:#6c757d">Name of the tab in your spreadsheet</small>
</div>
<div class="form-group">
<label style="display:flex;align-items:center;gap:10px">
<input type="checkbox" id="autoSync" style="width:auto">
Auto-sync every 5 minutes
</label>
</div>
<div class="action-btns">
<button class="btn btn-primary" onclick="saveGoogleSheetsConfig()"><i class="fas fa-save"></i> Connect</button>
<button class="btn btn-secondary" onclick="closeGoogleSheetsSetup()"><i class="fas fa-times"></i> Cancel</button>
</div>
</div>
</div>
<script>
let tasks=[];let currentFilter='all';let isAdmin=false;const ADMIN_PASSWORD='jct2025';
let googleConfig={apiKey:'',sheetId:'',sheetName:'Sheet1',autoSync:false};
let syncInterval=null;

function loadTasks(){const s=localStorage.getItem('jctTasks');if(s){tasks=JSON.parse(s)}else{tasks=getSampleTasks();saveTasks()}checkAdminStatus();loadGoogleConfig();renderDashboard();renderTaskTable()}

function loadGoogleConfig(){const saved=localStorage.getItem('jctGoogleConfig');if(saved){googleConfig=JSON.parse(saved);if(googleConfig.apiKey&&googleConfig.sheetId){document.getElementById('syncBtn').disabled=false;showSheetsStatus('Connected to Google Sheets','success');if(googleConfig.autoSync){startAutoSync()}}}}

function saveGoogleConfig(){localStorage.setItem('jctGoogleConfig',JSON.stringify(googleConfig))}

function startAutoSync(){if(syncInterval)clearInterval(syncInterval);syncInterval=setInterval(()=>{syncFromGoogleSheets(true)},5*60*1000)}

function stopAutoSync(){if(syncInterval){clearInterval(syncInterval);syncInterval=null}}

function showSheetsStatus(msg,type){const status=document.getElementById('sheetsStatus');status.style.display='block';status.style.background=type==='success'?'#d4edda':type==='error'?'#f8d7da':'#fff3cd';status.style.color=type==='success'?'#155724':type==='error'?'#721c24':'#856404';status.style.borderLeft=`5px solid ${type==='success'?'#28a745':type==='error'?'#dc3545':'#ffc107'}`;status.innerHTML=`<strong><i class="fas fa-${type==='success'?'check-circle':type==='error'?'exclamation-triangle':'info-circle'}"></i> ${msg}</strong>`;setTimeout(()=>status.style.display='none',5000)}

function openGoogleSheetsSetup(){if(!isAdmin){alert('Admin login required');return}document.getElementById('googleApiKey').value=googleConfig.apiKey||'';document.getElementById('googleSheetId').value=googleConfig.sheetId||'';document.getElementById('googleSheetName').value=googleConfig.sheetName||'Sheet1';document.getElementById('autoSync').checked=googleConfig.autoSync||false;document.getElementById('googleSheetsModal').classList.add('active')}

function closeGoogleSheetsSetup(){document.getElementById('googleSheetsModal').classList.remove('active')}

function saveGoogleSheetsConfig(){const apiKey=document.getElementById('googleApiKey').value.trim();const sheetId=document.getElementById('googleSheetId').value.trim();const sheetName=document.getElementById('googleSheetName').value.trim()||'Sheet1';const autoSync=document.getElementById('autoSync').checked;if(!apiKey||!sheetId){alert('Please provide both API Key and Sheet ID');return}googleConfig={apiKey,sheetId,sheetName,autoSync};saveGoogleConfig();document.getElementById('syncBtn').disabled=false;closeGoogleSheetsSetup();showSheetsStatus('Google Sheets connected successfully!','success');if(autoSync){startAutoSync();showSuccess('Auto-sync enabled (every 5 min)')}else{stopAutoSync()}syncFromGoogleSheets()}

async function syncFromGoogleSheets(silent=false){if(!googleConfig.apiKey||!googleConfig.sheetId){if(!silent)alert('Please configure Google Sheets connection first');return}if(!silent)showSheetsStatus('Syncing from Google Sheets...','info');try{const range=`${googleConfig.sheetName}!A:I`;const url=`https://sheets.googleapis.com/v4/spreadsheets/${googleConfig.sheetId}/values/${range}?key=${googleConfig.apiKey}`;const response=await fetch(url);if(!response.ok){const errorData=await response.json();throw new Error(errorData.error?.message||`HTTP ${response.status}`)}const data=await response.json();if(!data.values||data.values.length<2){throw new Error('Sheet is empty or has no data rows')}const headers=data.values[0];const rows=data.values.slice(1);const imported=[];const now=new Date().toISOString().split('T')[0];rows.forEach((row,idx)=>{if(row.length===0)return;const task={id:row[0]?parseInt(row[0]):(idx+1),description:row[1]||'No description',category:row[2]||'General',responsible:row[3]||'Unassigned',deadline:row[4]||'',status:row[5]||'Not Started',priority:row[6]||'Medium',remarks:row[7]||'',lastUpdated:row[8]||now};imported.push(task)});if(imported.length>0){tasks=imported;saveTasks();renderDashboard();renderTaskTable();if(!silent){showSheetsStatus(`✓ Synced ${imported.length} tasks from Google Sheets!`,'success');showSuccess(`Imported ${imported.length} tasks`)}}else{throw new Error('No valid tasks found in sheet')}}catch(error){console.error('Sync error:',error);if(!silent){showSheetsStatus(`✗ Sync failed: ${error.message}`,'error');alert(`Google Sheets sync failed:\n\n${error.message}\n\nPlease check:\n1. API Key is correct\n2. Sheet ID is correct\n3. Sheet is shared with: jcttrifold2025@gmail.com\n4. Google Sheets API is enabled in your project`)}}}

async function pushToGoogleSheets(){if(!googleConfig.apiKey||!googleConfig.sheetId){alert('Please configure Google Sheets connection first');return}if(!isAdmin){alert('Admin permission required');return}showSheetsStatus('Pushing tasks to Google Sheets...','info');try{const headers=['ID','Description','Category','Responsible','Deadline','Status','Priority','Remarks','Last Updated'];const rows=[headers,...tasks.map(t=>[t.id,t.description,t.category,t.responsible,t.deadline,t.status,t.priority,t.remarks||'',t.lastUpdated||''])];const range=`${googleConfig.sheetName}!A:I`;const url=`https://sheets.googleapis.com/v4/spreadsheets/${googleConfig.sheetId}/values/${range}?valueInputOption=RAW&key=${googleConfig.apiKey}`;const response=await fetch(url,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({values:rows})});if(!response.ok){throw new Error(`Failed to push: ${response.status} ${response.statusText}`)}showSheetsStatus(`Successfully pushed ${tasks.length} tasks to Google Sheets!`,'success')}catch(error){console.error('Push error:',error);showSheetsStatus(`Push failed: ${error.message}`,'error')}}

function checkAdminStatus(){const saved=sessionStorage.getItem('jctAdminLoggedIn');isAdmin=saved==='true';updateUIForRole()}
function updateUIForRole(){const status=document.getElementById('loginStatus');const logoutBtn=document.getElementById('logoutBtn');const actionBtns=document.querySelector('.action-btns');if(isAdmin){status.innerHTML='<i class="fas fa-user-shield"></i> Admin Mode';status.style.color='#28a745';logoutBtn.style.display='inline-flex';if(actionBtns)actionBtns.style.display='flex'}else{status.innerHTML='<i class="fas fa-eye"></i> View Mode';status.style.color='#ffc107';logoutBtn.style.display='none';if(actionBtns)actionBtns.style.display='none'}}
function showLoginModal(){document.getElementById('loginModal').classList.add('active');document.getElementById('adminPassword').value=''}
function closeLoginModal(){document.getElementById('loginModal').classList.remove('active')}
function login(){const pwd=document.getElementById('adminPassword').value;if(pwd===ADMIN_PASSWORD){isAdmin=true;sessionStorage.setItem('jctAdminLoggedIn','true');updateUIForRole();closeLoginModal();showSuccess('Logged in as Admin!');renderTaskTable()}else{alert('Invalid password!');document.getElementById('adminPassword').value=''}}
function logout(){isAdmin=false;sessionStorage.removeItem('jctAdminLoggedIn');updateUIForRole();showSuccess('Logged out');renderTaskTable()}
function saveTasks(){localStorage.setItem('jctTasks',JSON.stringify(tasks));showSuccess('Saved')}
function getSampleTasks(){const now=new Date().toISOString().split('T')[0];return[{id:1,description:"Entrance neat and clean",category:"Arts & Science",responsible:"Vinod/Manikam",deadline:"Daily",status:"In Progress",priority:"Medium",remarks:"",lastUpdated:now},{id:2,description:"XEROX Center needed",category:"Arts & Science",responsible:"Senthil supervisor",deadline:"2025-11-24",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:3,description:"Surveillance cameras",category:"Arts & Science",responsible:"vineeth",deadline:"2025-11-24",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:4,description:"Girls toilet incinerator",category:"Polytechnic",responsible:"Senthil/manager",deadline:"Completed",status:"Completed",priority:"Low",remarks:"",lastUpdated:now},{id:5,description:"All damaged chairs repair",category:"Engineering",responsible:"Senthil supervisor",deadline:"2025-11-06",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:6,description:"Floor repair work",category:"Engineering",responsible:"Senthil supervisor",deadline:"2025-11-30",status:"Not Started",priority:"High",remarks:"1000 Sq.ft tiles",lastUpdated:now},{id:7,description:"Smart board purchase",category:"Engineering",responsible:"Manager",deadline:"2025-11-30",status:"Not Started",priority:"High",remarks:"4 classrooms",lastUpdated:now},{id:8,description:"Rolling shutter service",category:"Engineering",responsible:"Senthil supervisor",deadline:"2025-11-16",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:9,description:"Wire purchase for centre",category:"Campus",responsible:"Senthil/Manager",deadline:"2025-11-14",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:10,description:"Ladies washroom ready",category:"Campus",responsible:"Senthil supervisor",deadline:"2025-12-30",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:11,description:"Heavy Duty Incinerator",category:"Girls Hostel",responsible:"Electrician/manager",deadline:"2025-11-08",status:"Not Started",priority:"High",remarks:"2 more needed",lastUpdated:now},{id:12,description:"Fan and tube purchase",category:"Girls Hostel",responsible:"Electrician/manager",deadline:"2025-11-04",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:13,description:"Camera installation",category:"Boys Hostel",responsible:"vineeth",deadline:"2025-11-08",status:"In Progress",priority:"High",remarks:"2nd & 3rd floor",lastUpdated:now},{id:14,description:"STP plant hostel B",category:"Boys Hostel",responsible:"Senthil/Manager",deadline:"",status:"In Progress",priority:"High",remarks:"3 months",lastUpdated:now},{id:15,description:"Cooking vessels",category:"Mess",responsible:"Jayaraj/Manager",deadline:"2025-11-08",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:16,description:"Industrial mixer",category:"Mess",responsible:"Jayaraj/Manager",deadline:"",status:"Not Started",priority:"Medium",remarks:"",lastUpdated:now},{id:17,description:"Steamers service",category:"Mess",responsible:"Jayaraj",deadline:"2025-11-03",status:"Not Started",priority:"High",remarks:"",lastUpdated:now},{id:18,description:"Tata Ace repair",category:"Transport",responsible:"Transport/Manager",deadline:"",status:"Not Started",priority:"Medium",remarks:"Exchange",lastUpdated:now},{id:19,description:"First aid kits",category:"Transport",responsible:"Transport Incharge",deadline:"",status:"Not Started",priority:"High",remarks:"All buses",lastUpdated:now},{id:20,description:"Three new buses",category:"Transport",responsible:"Transport/Manager",deadline:"2025-10-29",status:"In Progress",priority:"High",remarks:"",lastUpdated:now}]}
function switchTab(t){document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));event.target.closest('.tab').classList.add('active');document.getElementById(t).classList.add('active')}
function filterByCategory(c){currentFilter=c;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');renderDashboard()}
function renderDashboard(){const f=currentFilter==='all'?tasks:tasks.filter(t=>t.category===currentFilter);const total=f.length;const completed=f.filter(t=>t.status==='Completed').length;const progress=f.filter(t=>t.status==='In Progress').length;const overdue=f.filter(t=>isOverdue(t.deadline)&&t.status!=='Completed').length;document.getElementById('totalTasks').textContent=total;document.getElementById('completedTasks').textContent=completed;document.getElementById('progressTasks').textContent=progress;document.getElementById('overdueTasks').textContent=overdue;const pct=total>0?Math.round((completed/total)*100):0;document.getElementById('progressBar').style.width=pct+'%';document.getElementById('progressBar').textContent=pct+'%';const urgent=f.filter(t=>t.priority==='High'&&t.status!=='Completed');const ul=document.getElementById('urgentTasksList');ul.innerHTML=urgent.length===0?'<div class="urgent-task">No urgent tasks! Great job!</div>':urgent.map(t=>`<div class="urgent-task"><strong>${t.description}</strong><br><small>${t.category} - ${t.responsible} - Due: ${t.deadline}</small></div>`).join('')}
function renderTaskTable(){const tb=document.getElementById('taskTableBody');tb.innerHTML=tasks.map(t=>`<tr><td>${t.id}</td><td>${t.description}</td><td>${t.category}</td><td>${t.responsible}</td><td>${t.deadline}</td><td>${getDaysBadge(t.deadline,t.status)}</td><td><span class="status-badge status-${t.status.toLowerCase().replace(' ','')}" ${isAdmin?`onclick="toggleStatus(${t.id})"`:'style="cursor:default"'}>${t.status}</span></td><td><span class="priority-badge priority-${t.priority.toLowerCase()}">${t.priority}</span></td><td>${t.lastUpdated||'N/A'}</td><td>${isAdmin?`<button class="btn btn-primary" onclick="editTask(${t.id})" style="padding:8px 15px;min-height:auto;margin-right:5px"><i class="fas fa-edit"></i></button><button class="btn btn-danger" onclick="deleteTask(${t.id})" style="padding:8px 15px;min-height:auto"><i class="fas fa-trash"></i></button>`:'<span style="color:#6c757d">View Only</span>'}</td></tr>`).join('')}
function getDaysBadge(d,s){if(s==='Completed')return'<span class="days-badge days-ok">Done</span>';if(d==='Daily'||d==='Daily routine'||d==='Regular work'||d==='Completed'||!d||d==='')return'<span class="days-badge days-ok">Ongoing</span>';const dd=new Date(d);const today=new Date();const diff=Math.ceil((dd-today)/(1000*60*60*24));if(diff<0)return`<span class="days-badge days-overdue">${Math.abs(diff)}d overdue</span>`;if(diff<=7)return`<span class="days-badge days-soon">${diff}d left</span>`;return`<span class="days-badge days-ok">${diff}d left</span>`}
function isOverdue(d){if(d==='Daily'||d==='Daily routine'||d==='Regular work'||d==='Completed'||!d||d==='')return false;const dd=new Date(d);const today=new Date();return dd<today}
function toggleStatus(id){if(!isAdmin)return;const t=tasks.find(x=>x.id===id);if(!t)return;const states=['Not Started','In Progress','Completed'];const i=states.indexOf(t.status);t.status=states[(i+1)%states.length];t.lastUpdated=new Date().toISOString().split('T')[0];saveTasks();renderDashboard();renderTaskTable()}
function deleteTask(id){if(!isAdmin)return;if(confirm('Delete this task?')){tasks=tasks.filter(t=>t.id!==id);saveTasks();renderDashboard();renderTaskTable()}}
function editTask(id){if(!isAdmin)return;const t=tasks.find(x=>x.id===id);if(!t)return;document.getElementById('modalTitle').textContent='Edit Task';document.getElementById('editTaskId').value=t.id;document.getElementById('taskDesc').value=t.description;document.getElementById('taskCategory').value=t.category;document.getElementById('taskResponsible').value=t.responsible;document.getElementById('taskDeadline').value=t.deadline;document.getElementById('taskStatus').value=t.status;document.getElementById('taskPriority').value=t.priority;document.getElementById('taskRemarks').value=t.remarks||'';document.getElementById('addTaskModal').classList.add('active')}
function openAddTaskModal(){if(!isAdmin){alert('Admin login required to add tasks');return}document.getElementById('modalTitle').textContent='Add Task';document.getElementById('editTaskId').value='';document.getElementById('taskDesc').value='';document.getElementById('taskCategory').value='';document.getElementById('taskResponsible').value='';document.getElementById('taskDeadline').value='';document.getElementById('taskStatus').value='Not Started';document.getElementById('taskPriority').value='Low';document.getElementById('taskRemarks').value='';document.getElementById('addTaskModal').classList.add('active')}
function closeAddTaskModal(){document.getElementById('addTaskModal').classList.remove('active')}
function saveTask(){if(!isAdmin)return;const editId=document.getElementById('editTaskId').value;const desc=document.getElementById('taskDesc').value;const cat=document.getElementById('taskCategory').value;const resp=document.getElementById('taskResponsible').value;const dead=document.getElementById('taskDeadline').value;const stat=document.getElementById('taskStatus').value;const pri=document.getElementById('taskPriority').value;const rem=document.getElementById('taskRemarks').value;if(!desc||!cat||!resp){alert('Please fill required fields');return}const now=new Date().toISOString().split('T')[0];if(editId){const t=tasks.find(x=>x.id===parseInt(editId));if(t){t.description=desc;t.category=cat;t.responsible=resp;t.deadline=dead;t.status=stat;t.priority=pri;t.remarks=rem;t.lastUpdated=now;showSuccess('Task updated!')}}else{const maxId=tasks.length>0?Math.max(...tasks.map(t=>t.id)):0;tasks.push({id:maxId+1,description:desc,category:cat,responsible:resp,deadline:dead,status:stat,priority:pri,remarks:rem,lastUpdated:now});showSuccess('Task added!')}saveTasks();renderDashboard();renderTaskTable();closeAddTaskModal()}
function exportToCSV(){const csv=['ID,Description,Category,Responsible,Deadline,Status,Priority,Remarks,Last Updated',...tasks.map(t=>`${t.id},"${t.description}","${t.category}","${t.responsible}",${t.deadline},${t.status},${t.priority},"${t.remarks}",${t.lastUpdated||''}`)].join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='jct-tasks-'+new Date().toISOString().split('T')[0]+'.csv';a.click();showSuccess('Exported!')}
function importFromCSV(e){if(!isAdmin){alert('Admin login required to import');return}const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(ev){try{const text=ev.target.result;const lines=text.split('\n');if(lines.length<2){alert('CSV file is empty or invalid');return}const imported=[];const now=new Date().toISOString().split('T')[0];for(let i=1;i<lines.length;i++){const line=lines[i].trim();if(!line||line.length<5)continue;const cells=[];let current='';let inQuotes=false;for(let j=0;j<line.length;j++){const char=line[j];if(char==='"'){inQuotes=!inQuotes}else if(char===','&&!inQuotes){cells.push(current.trim().replace(/^"|"$/g,''));current=''}else{current+=char}}cells.push(current.trim().replace(/^"|"$/g,''));if(cells.length>=3){imported.push({id:cells[0]?parseInt(cells[0]):(i),description:cells[1]||'No description',category:cells[2]||'General',responsible:cells[3]||'Unassigned',deadline:cells[4]||'',status:cells[5]||'Not Started',priority:cells[6]||'Medium',remarks:cells[7]||'',lastUpdated:cells[8]||now})}}if(imported.length>0){if(confirm(`Import ${imported.length} tasks? This will replace current data.`)){tasks=imported;saveTasks();renderDashboard();renderTaskTable();showSuccess(`Imported ${imported.length} tasks!`)}}else{alert('No valid tasks found in CSV file')}}catch(error){console.error('Import error:',error);alert('Failed to import CSV. Please check file format.')}finally{e.target.value=''}};reader.readAsText(file)}
function showSuccess(msg){const sm=document.getElementById('successMessage');document.getElementById('successText').textContent=msg;sm.classList.add('show');setTimeout(()=>sm.classList.remove('show'),2000)}
loadTasks();
</script>Completed'||!d||d==='')return false;const dd=new Date(d);const today=new Date();return dd<today}
function toggleStatus(id){if(!isAdmin)return;const t=tasks.find(x=>x.id===id);if(!t)return;const states=['Not Started','In Progress','Completed'];const i=states.indexOf(t.status);t.status=states[(i+1)%states.length];t.lastUpdated=new Date().toISOString().split('T')[0];saveTasks();renderDashboard();renderTaskTable()}
function deleteTask(id){if(!isAdmin)return;if(confirm('Delete this task?')){tasks=tasks.filter(t=>t.id!==id);saveTasks();renderDashboard();renderTaskTable()}}
function editTask(id){if(!isAdmin)return;const t=tasks.find(x=>x.id===id);if(!t)return;document.getElementById('modalTitle').textContent='Edit Task';document.getElementById('editTaskId').value=t.id;document.getElementById('taskDesc').value=t.description;document.getElementById('taskCategory').value=t.category;document.getElementById('taskResponsible').value=t.responsible;document.getElementById('taskDeadline').value=t.deadline;document.getElementById('taskStatus').value=t.status;document.getElementById('taskPriority').value=t.priority;document.getElementById('taskRemarks').value=t.remarks||'';document.getElementById('addTaskModal').classList.add('active')}
function openAddTaskModal(){if(!isAdmin){alert('Admin login required to add tasks');return}document.getElementById('modalTitle').textContent='Add Task';document.getElementById('editTaskId').value='';document.getElementById('taskDesc').value='';document.getElementById('taskCategory').value='';document.getElementById('taskResponsible').value='';document.getElementById('taskDeadline').value='';document.getElementById('taskStatus').value='Not Started';document.getElementById('taskPriority').value='Low';document.getElementById('taskRemarks').value='';document.getElementById('addTaskModal').classList.add('active')}
function closeAddTaskModal(){document.getElementById('addTaskModal').classList.remove('active')}
function saveTask(){if(!isAdmin)return;const editId=document.getElementById('editTaskId').value;const desc=document.getElementById('taskDesc').value;const cat=document.getElementById('taskCategory').value;const resp=document.getElementById('taskResponsible').value;const dead=document.getElementById('taskDeadline').value;const stat=document.getElementById('taskStatus').value;const pri=document.getElementById('taskPriority').value;const rem=document.getElementById('taskRemarks').value;if(!desc||!cat||!resp){alert('Please fill required fields');return}const now=new Date().toISOString().split('T')[0];if(editId){const t=tasks.find(x=>x.id===parseInt(editId));if(t){t.description=desc;t.category=cat;t.responsible=resp;t.deadline=dead;t.status=stat;t.priority=pri;t.remarks=rem;t.lastUpdated=now;showSuccess('Task updated!')}}else{const maxId=tasks.length>0?Math.max(...tasks.map(t=>t.id)):0;tasks.push({id:maxId+1,description:desc,category:cat,responsible:resp,deadline:dead,status:stat,priority:pri,remarks:rem,lastUpdated:now});showSuccess('Task added!')}saveTasks();renderDashboard();renderTaskTable();closeAddTaskModal()}
function exportToCSV(){const csv=['ID,Description,Category,Responsible,Deadline,Status,Priority,Remarks,Last Updated',...tasks.map(t=>`${t.id},"${t.description}","${t.category}","${t.responsible}",${t.deadline},${t.status},${t.priority},"${t.remarks}",${t.lastUpdated||''}`)].join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='jct-tasks-'+new Date().toISOString().split('T')[0]+'.csv';a.click();showSuccess('Exported!')}
function importFromCSV(e){if(!isAdmin){alert('Admin login required to import');return}const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(ev){const lines=ev.target.result.split('\n');const imported=[];for(let i=1;i<lines.length;i++){const line=lines[i].trim();if(!line)continue;const match=line.match(/(\d+),"([^"]*)","([^"]*)","([^"]*)",([^,]*),([^,]*),([^,]*),"([^"]*)",?([^,]*)?/);if(match){imported.push({id:parseInt(match[1]),description:match[2],category:match[3],responsible:match[4],deadline:match[5],status:match[6],priority:match[7],remarks:match[8],lastUpdated:match[9]||new Date().toISOString().split('T')[0]})}}if(imported.length>0){if(confirm(`Import ${imported.length} tasks? This will replace current data.`)){tasks=imported;saveTasks();renderDashboard();renderTaskTable();showSuccess('Imported!')}}};reader.readAsText(file)}
function showSuccess(msg){const sm=document.getElementById('successMessage');document.getElementById('successText').textContent=msg;sm.classList.add('show');setTimeout(()=>sm.classList.remove('show'),2000)}
loadTasks();
</script>
</body>
</html>